<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Module to show information of application"
    height="100">
    <Require feature="dynamic-height"/>
  </ModulePrefs>
  <Content type="html">
  <![CDATA[
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
  <script type="text/javascript">
    function init(){
        var urlApp = (window.location != window.parent.location)
                ? document.referrer
                : document.location.href;
        urlApp = urlApp.split("/");
        urlApp = urlApp[urlApp.length - 1];

        var applicationName = urlApp.replace(new RegExp('-', 'g'), '%20');

        var url = "https://spreadsheets.google.com/feeds/list/1wsybm0u3HvELqq0c7gjYWXmJUnJVm3W45q3G-eoX8bs/4/public/basic?alt=json&sq=applicationname=\"" + applicationName + "\"";
        $.ajax({
            url:url,
            async: false,
            dataType:"jsonp",
            success:function(data) {
                createObj(data.feed.entry);
            },
        });

        var arrayToShow = [];

        function createObj(dataEntry){
            dataEntry.forEach(function(response){
                var returnObj = {};
                response = response['content']['$t'].split(", ");

                response.forEach(function(el){
                    var elArry = el.split(": ");
                    returnObj[elArry[0]] = elArry[1];
                });
                
                arrayToShow.push(returnObj);
            });

            buildHTLM(arrayToShow[0]);
        };  
        gadgets.window.adjustHeight();
    }

    function buildHTLM(app){
        $(".simple__information_name").html(app.applicationname);
        $(".simple__information_description").html(app.description);

        var listFunctions = app.crucialfunctions.split("\n");
        listFunctions.forEach(function(el){
            $(".details__information_box_list").append("<li>" + el + "</li>");
        });

        var arrayAppOptions = [["cost", "Cost"], ["approvalpolicy", "Approval policy"], ["deliverytime", "Delivery time"], ["devicecompatibility", "Device compatibility"], ["mobileappavailability", "Mobile app availability"]];

        arrayAppOptions.forEach(function(el){
            if(app[el[0]] != undefined){
                if($(".details__information_col.second .details__information_box").length <=  $(".details__information_col.last .details__information_box").length){
                    $(".details__information_col.second").append("<div class='details__information_box'> \
                        <p class='details__information_box_title'>" + el[1] + "</p> \
                        <div class='details__information_box_inner'> \
                            <p>" + app[el[0]] + "</p> \
                        </div> \
                    </div>");
                }
                else{
                    $(".details__information_col.last").append("<div class='details__information_box'> \
                            <p class='details__information_box_title'>" + el[1] + "</p> \
                            <div class='details__information_box_inner'> \
                                <p>" + app[el[0]] + "</p> \
                            </div> \
                        </div>");
                }
            }
        });
    }

    function showAllInformation(){
        $(".details__information").toggleClass("active");
        $(".more_capability").toggleClass("active");
        if($(".more_capability").hasClass('active')){
          $(".textButton").html("Read less");
        }
        else{
          $(".textButton").html("Read more");
        }
        gadgets.window.adjustHeight();;
    }

    window.addEventListener('DOMContentLoaded', init)
</script>
<style>
    .information__wrapper{
        min-height: 525px;
        box-shadow: 0 1px 6px rgba(0, 0, 0, 0.15);
        border-radius: 6px;
        background-color: #ffffff;
        width: calc(100% - 12px);
        margin: 0 auto;
        margin-top: 2px;
        padding: 0 35px;
        box-sizing: border-box;
        margin-bottom: 6px;
        padding-bottom: 44px;
    }
    .simple__information{
        padding-top: 52px;
        box-sizing: border-box;
        border-bottom: 1px solid #e7e7e7;
        padding-bottom: 13px;   
    }
    .simple__information_name{
        color: #3e78bd;
        font-family: Robotto, sans-serif;
        font-size: 30px;
        font-weight: 500;
        letter-spacing: 0.6px;
        margin: 0;
    }
    .simple__information_description{
        color: #000000;
        font-family: Robotto, sans-serif;
        font-size: 20px;
        font-weight: 600;
        letter-spacing: 0.4px;
        margin: 0;
        margin-top: 2px;
        height: 70px;
    }
    .details__information_box_title{
        color: #000000;
        font-family: Robotto, sans-serif;
        font-size: 20px;
        font-weight: 600;
        letter-spacing: 0.4px;
        margin: 0;
        margin-bottom: 25px;
    }
    .details__information_box_list{
        list-style-type: none;
        margin: 0;
        padding: 0;
        color: #000000;
        font-family: Robotto, sans-serif;
        font-size: 18px;
        font-weight: 400;
    }
    .details__information_box_list li{
        padding-left: 20px;
        position: relative;
        margin-bottom: 13px;
    }
    .details__information_box_list li:before{
        content: '';
        display: block;
        position: absolute;
        width: 5px;
        height: 5px;
        background: #3e78bd;
        border-radius: 50%;
        left: 0;
        top: 8px;
    }
    .details__information_col{
        width: 510px;
        display: inline-block;
        vertical-align: top;
        box-sizing: border-box;
        padding-right: 40px;
    }
    .details__information_col.second{
        width: 337px;
    }
    .details__information_col.last{
        width: 317px;
    }
    .details__information{
        padding-top: 29px;
        box-sizing: border-box;
        height: 240px;
        overflow: hidden;   
    }
    .details__information.active{
        height: auto;
    }
    .details__information_box_inner{
        margin-bottom: 49px;
    }
    .details__information_box_inner p{
        margin: 0;
        padding: 0;
        color: #000000;
        font-family: Robotto, sans-serif;
        font-size: 18px;
        font-weight: 400;
    }
    .more_capability{
        width: 115px;
        height: 49px;
        position: relative;
        border-radius: 6px;
        background-color: #3e78bd;
        display: flex;
        margin-bottom: 25px;
        color: #ffffff;
        font-family: Robotto, sans-serif;
        font-size: 14px;
        font-weight: 300;
        letter-spacing: 0.32px;
        border: 0;
        padding-left: 32px;
        margin: 0 auto;
        margin-top: 20px;
        cursor: pointer;
    }
    .arrowMore{
        display: block;
        background: url(https://sites.google.com/a/roche.com/user-productivity-tools/arrow.png) no-repeat;
        width: 11px;
        height: 6px;
        position: absolute;
        top: 50%;
        transform: translateY(-50%) rotate(0);
        left: 12px;
        background-size: cover;
        transition: .2s;
    }
    .active .arrowMore{
        transform: translateY(-50%) rotate(180deg);
    }
</style>
<div class="information__wrapper">
    <div class="simple__information">
        <h2 class="simple__information_name"></h2>
        <p class="simple__information_description"></p>
    </div>
    <div class="details__information">
        <div class="details__information_col">
            <div class="details__information_box">
                <p class="details__information_box_title">Crucial Functions</p>
                <div class="details__information_box_inner">
                    <ul class="details__information_box_list">
                    </ul>
                </div>
            </div>
        </div>
        <div class="details__information_col second">

        </div>
        <div class="details__information_col last">

        </div>
    </div>
    <button type="button" onclick="showAllInformation()" class="more_capability"><span class="arrowMore"></span><span class="textButton">Read more</span></button>
</div>
  ]]>
  </Content>
</Module>